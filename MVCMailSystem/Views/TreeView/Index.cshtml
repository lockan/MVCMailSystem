@model IEnumerable<MVCMailSystem.Models.Employee>

@{
    ViewBag.Title = "Organization Structure";
}

<h2>@ViewBag.Title</h2>

<div id="tree">
    <ul>
        @foreach (var item in Model)
        {
            if (item.stafftype == "admin")
            {
                <li id=@item.EmployeeID>
                    @Html.DisplayFor(modelItem => item.firstname)
                    <ul>
                        @foreach (var t in Model)
                        {
                            if (t.stafftype == "manager")
                            {
                                <li id=@t.EmployeeID>
                                    @Html.DisplayFor(modelItem => t.firstname)
                                    <ul>
                                        @foreach (var s in Model)
                                        {
                                            if (t.EmployeeID == s.mgrID)
                                            {
                                                <li id=@s.EmployeeID>
                                                    @Html.DisplayFor(modelItem => s.firstname)
                                                </li>
                                            }
                                        }
                                    </ul>
                                </li>
                            }
                        }
                    </ul>
                </li>
            }
        }
    </ul>
</div>
<script>
    $(function () {
        $("#tree").jstree(
            {
                "checkbox": {
                    "three_state": false
                },
                "plugins": ["checkbox"]
            }
      )
    });

    //  Displays selected node information - id and text from the tree.
    //  Notice that multiple nodes may have same text, but the id is nunique
    function display_selected_node() {
        var selectedNodeIds = [];
        var selectedNodeTexts = [];

        // slectedNodes is an array that stores selected nodes from the tree
        var selectedNodes = $('#tree').jstree("get_selected", true);

        $.each(selectedNodes, function () {
            // stores ids of selected nodes
            selectedNodeIds.push(this.id);

            // stores texts of selected nodes
            selectedNodeTexts.push(this.text);
        });

        // displays ids of the selected nodes
        document.getElementById('result_ids').innerHTML = selectedNodeIds.join(", ");

        // displays texts of the selected nodes
        document.getElementById('result_texts').innerHTML = selectedNodeTexts.join(", ");


        @*
            passes selected ids to the controller
        *@
        document.getElementById('selected_ids').value = $('#tree').jstree("get_selected");

    }
</script>

<!-- button that fires display_selected_node function above on click -->
<button onclick="display_selected_node()">See Tree Data from Client</button>

<br />
<br />
<br />

@*The results generated at client side displayed here.*@
Selected Node IDs:
<div id="result_ids"></div>

<br />
<br />

Selected Node Texts:
<div id="result_texts"></div>

<br />
<br />
<br />

@using (Html.BeginForm("Index", "TreeView", FormMethod.Post,
                                      new { enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)
    <fieldset>

        @*
            hidden input type. the data is retrieved from the script above.
                - JStree version of selected node ids
        *@
        <input id="selected_ids" name="employees" type="hidden" />
        <input type="submit" value="Send To Server" onclick="display_selected_node()" />
    </fieldset>
}

@*
    The refined version of selected node ids that are retieved from the server
    display at here.
*@
<h2>Refined Version of Selected Node IDs from the Server:</h2>
<h3>@ViewBag.SelectedEmployees</h3>